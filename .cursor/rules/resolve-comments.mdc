---
alwaysApply: false
---

## Resolve PR Comments

### Purpose

This rule helps the agent automatically fetch comments from the latest open Pull Request, analyze them, and apply the required code changes using **GitHub MCP tools**.

### Procedure

#### 1. Fetch information about the PR for current branch

First, get the current branch name:

```bash
git branch --show-current
```

Then find the open Pull Request for this branch using MCP:

```
mcp_github_list_pull_requests(owner: "jaqb8", repo: "language-learning-buddy", state: "open", head: "jaqb8:<branch_name>")
```

The `head` parameter filters PRs by the source branch in format `owner:branch`.

Save the PR number (`number`) for further use.

#### 2. Fetch comments from PR

Fetch all comments from the PR using the following MCP tools:

**Review comments (inline comments on code lines):**

```
mcp_github_pull_request_read(method: "get_review_comments", owner: "jaqb8", repo: "language-learning-buddy", pullNumber: <PR_NUMBER>)
```

**General reviews:**

```
mcp_github_pull_request_read(method: "get_reviews", owner: "jaqb8", repo: "language-learning-buddy", pullNumber: <PR_NUMBER>)
```

**Discussion comments:**

```
mcp_github_pull_request_read(method: "get_comments", owner: "jaqb8", repo: "language-learning-buddy", pullNumber: <PR_NUMBER>)
```

**PR details and changed files:**

```
mcp_github_pull_request_read(method: "get", owner: "jaqb8", repo: "language-learning-buddy", pullNumber: <PR_NUMBER>)
mcp_github_pull_request_read(method: "get_files", owner: "jaqb8", repo: "language-learning-buddy", pullNumber: <PR_NUMBER>)
```

#### 3. Analyze comments

Analyze the fetched comments and identify:

- **Comments requiring code changes** - indicate errors, improvements, or requirements
- **Informational comments** - do not require changes, only confirmation
- **Already resolved comments** - check if changes have already been applied to the code

For each comment requiring action:

1. **Identify file and location** - check `path` and `line` in the comment
2. **Understand context** - read the relevant code section in the file
3. **Determine required changes** - based on the comment content
4. **Verify current state** - check if the problem still exists

#### 4. Applying changes

For each comment requiring changes:

1. **Read the relevant file** - use `read_file` to read the file indicated in the comment
2. **Apply changes** - implement fixes according to suggestions from the comment
3. **Maintain consistency** - ensure changes are consistent with:
   - Project coding conventions
   - Application architecture
   - Existing code patterns
4. **Check dependencies** - ensure changes don't break other parts of the code

#### 5. Verify changes

After applying changes:

1. **Check linter** - run `read_lints` for modified files
2. **Verify logic** - ensure changes resolve the problem indicated in the comment
3. **Check tests** - if there are tests related to the modified code, ensure they still pass

### Example workflow

```
# 1. Get current branch name
git branch --show-current
# Returns e.g., "feature/my-feature"

# 2. Find the open PR for this branch
mcp_github_list_pull_requests(owner: "jaqb8", repo: "language-learning-buddy", state: "open", head: "jaqb8:feature/my-feature")
# Returns PR with number, e.g., 58

# 3. Fetch review comments (inline)
mcp_github_pull_request_read(method: "get_review_comments", owner: "jaqb8", repo: "language-learning-buddy", pullNumber: 58)

# 4. Fetch general reviews
mcp_github_pull_request_read(method: "get_reviews", owner: "jaqb8", repo: "language-learning-buddy", pullNumber: 58)

# 5. Fetch discussion comments
mcp_github_pull_request_read(method: "get_comments", owner: "jaqb8", repo: "language-learning-buddy", pullNumber: 58)

# 6. Analyze comments (agent performs this automatically)
# 7. Apply code changes (agent performs this automatically)
# 8. Verify changes (agent performs this automatically)
```

### MCP Tools Reference

| Tool | Method | Description |
|------|--------|-------------|
| `mcp_github_list_pull_requests` | - | List PRs with filters (state, sort, direction) |
| `mcp_github_pull_request_read` | `get` | Get PR details |
| `mcp_github_pull_request_read` | `get_diff` | Get PR diff |
| `mcp_github_pull_request_read` | `get_files` | Get list of changed files |
| `mcp_github_pull_request_read` | `get_review_comments` | Get inline review comments on code |
| `mcp_github_pull_request_read` | `get_reviews` | Get PR reviews |
| `mcp_github_pull_request_read` | `get_comments` | Get discussion comments |
| `mcp_github_pull_request_read` | `get_status` | Get CI/CD status |

### Best practices

#### ✅ Do

- **Read full context** - not just the line indicated in the comment, but also surrounding code
- **Understand intent** - make sure you understand what the reviewer wants to achieve
- **Maintain code style** - use existing conventions and patterns
- **Test changes** - if possible, verify that changes work correctly
- **Communicate** - if a comment is unclear, ask for clarification or apply the best solution
- **Use pagination** - for PRs with many comments, use `perPage` and `page` parameters

#### ❌ Don't

- **Don't make changes without understanding** - if a comment is unclear, it's better to ask than guess
- **Don't ignore context** - changes should be consistent with the rest of the code
- **Don't break existing functionality** - ensure changes don't introduce regressions
- **Don't skip validation** - always check linter and tests after applying changes

### Handling different types of comments

#### Inline comments (on code lines)

Fetched via `get_review_comments` method. Each comment contains:
- `path` - file path
- `line` / `original_line` - line number
- `body` - comment content
- `diff_hunk` - code context

**Example action:**

1. Find the file and line indicated in the comment
2. Read the code around that line using `read_file`
3. Apply the suggested change or fix
4. Verify that the change resolves the problem

#### Review comments (general)

Fetched via `get_reviews` method. Each review contains:
- `state` - APPROVED, CHANGES_REQUESTED, COMMENTED
- `body` - review summary
- Associated inline comments

**Example action:**

1. Read the entire review comment
2. Identify all files that may require changes
3. Apply changes systematically
4. Verify that all suggestions have been addressed

#### Discussion comments

Fetched via `get_comments` method. These are general PR comments not attached to specific code lines.

**Example action:**

1. Determine if the comment requires code changes or just a response
2. If it requires changes, apply them according to the instructions above
3. If it only requires a response, consider adding an explanatory comment

### Final notes

- **Prioritize** - start with the most important comments (e.g., regarding security or errors)
- **Be systematic** - go through comments one by one
- **Document changes** - if you're making significant changes, consider adding a code comment
- **Communicate progress** - if you can't resolve a comment, inform about it
- **Check thread status** - review comments may have `isResolved` field indicating if the thread was resolved
