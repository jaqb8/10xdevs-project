---
import AppLayout from "../layouts/AppLayout.astro";
import { LearningItemsView } from "../components/views/LearningItemsView";
import { isFeatureEnabled } from "@/features/feature-flags.service";
import { fetchInitialLearningItems } from "@/lib/fetch-initial-learning-items";

if (!isFeatureEnabled("learning-items")) {
  return Astro.redirect("/");
}

const { user, supabase } = Astro.locals;

const { initialData, status } = user
  ? await fetchInitialLearningItems(supabase, user.id)
  : { initialData: null, status: "unauthenticated" as const };
---

<AppLayout title="Moje elementy do nauki - Language Learning Buddy">
  <LearningItemsView initialData={initialData} initialLoadError={status === "error"} client:load />
</AppLayout>
